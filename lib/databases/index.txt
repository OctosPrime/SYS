const mysql = require('mysql');

const db = mysql.createConnection({
  host: 'sysmedicalapp.mysql.dbaas.com.br',
  user: 'sysmedicalapp',
  password: 'SysMedical123!',
  database: 'sysmedicalapp'
});

db.connect((err) => {
  if (err) {
    console.error('Erro ao conectar ao banco de dados:', err);
    return;
  }
  console.log('Conectado ao banco de dados MySQL');
});

const verificarOuCriarTabelas = () => {
    db.query("SHOW TABLES LIKE 'usuarios';", (err, result) => {
      if (err) throw err;
      if (result.length === 0) {
        const criarTabelaUsuarios = `
          CREATE TABLE usuarios (
            id INT AUTO_INCREMENT PRIMARY KEY,
            nome VARCHAR(100) NOT NULL,
            email VARCHAR(100) UNIQUE NOT NULL,
            celular VARCHAR(15),
            senha VARCHAR(100) NOT NULL,
            adm INT(11) NOT NULL
          );
        `;
        db.query(criarTabelaUsuarios, (err, result) => {
          if (err) throw err;
          console.log("Tabela 'usuarios' criada com sucesso.");
        });
      } else {
        console.log("Tabela 'usuarios' já existe.");
      }
    });
  
    db.query("SHOW TABLES LIKE 'chamados';", (err, result) => {
      if (err) throw err;
      if (result.length === 0) {
        const criarTabelaChamados = `
          CREATE TABLE chamados (
            id INT AUTO_INCREMENT PRIMARY KEY,
            tipo VARCHAR(50) NOT NULL,
            chamado VARCHAR(50) UNIQUE NOT NULL,
            cliente VARCHAR(50) NOT NULL,
            equipamento VARCHAR(100) NOT NULL,
            data DATETIME,
            endereco VARCHAR(100) NOT NULL,
            celular VARCHAR(11) NOT NULL,
            link VARCHAR(150),
            observacao VARCHAR(200),
            tecnico VARCHAR(100) NOT NULL,
            status VARCHAR(50) NOT NULL
          );
        `;
        db.query(criarTabelaChamados, (err, result) => {
          if (err) throw err;
          console.log("Tabela 'chamados' criada com sucesso.");
        });
      } else {
        console.log("Tabela 'chamados' já existe.");
      }
    });
  };
  
  // Chamar a função ao iniciar o servidor
  verificarOuCriarTabelas();

  